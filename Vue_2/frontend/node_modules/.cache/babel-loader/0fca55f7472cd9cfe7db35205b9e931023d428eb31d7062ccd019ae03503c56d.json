{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, renderList as _renderList, Fragment as _Fragment, toDisplayString as _toDisplayString } from \"vue\";\nconst _hoisted_1 = {\n  class: \"container\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"text-center py-5\"\n};\nconst _hoisted_3 = {\n  key: 1,\n  class: \"text-center py-5\"\n};\nconst _hoisted_4 = {\n  key: 2,\n  class: \"list-group\"\n};\nconst _hoisted_5 = [\"onClick\"];\nconst _hoisted_6 = {\n  class: \"avatar bg-primary text-white rounded-circle d-flex align-items-center justify-content-center\",\n  style: {\n    \"width\": \"50px\",\n    \"height\": \"50px\",\n    \"flex-shrink\": \"0\"\n  }\n};\nconst _hoisted_7 = {\n  class: \"flex-grow-1 min-w-0\"\n};\nconst _hoisted_8 = {\n  class: \"d-flex justify-content-between align-items-center mb-1\"\n};\nconst _hoisted_9 = {\n  class: \"mb-0\"\n};\nconst _hoisted_10 = {\n  class: \"text-muted\"\n};\nconst _hoisted_11 = {\n  class: \"mb-0 text-truncate\"\n};\nconst _hoisted_12 = {\n  key: 0,\n  class: \"badge bg-danger align-self-start\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_router_link = _resolveComponent(\"router-link\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createCommentVNode(\" 加载中提示 \"), $data.loading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [...(_cache[0] || (_cache[0] = [_createElementVNode(\"div\", {\n    class: \"spinner-border text-primary\",\n    role: \"status\"\n  }, [_createElementVNode(\"span\", {\n    class: \"visually-hidden\"\n  }, \"Loading...\")], -1 /* CACHED */)]))])) : _createCommentVNode(\"v-if\", true), _createCommentVNode(\" 页面标题 \"), _cache[3] || (_cache[3] = _createElementVNode(\"h2\", {\n    class: \"my-4\"\n  }, \"我的消息\", -1 /* CACHED */)), _createCommentVNode(\" 没有消息时显示 \"), !$data.loading && $data.conversations.length === 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [_cache[2] || (_cache[2] = _createElementVNode(\"p\", {\n    class: \"text-muted\"\n  }, \"你还没有任何消息\", -1 /* CACHED */)), _createVNode(_component_router_link, {\n    to: \"/\",\n    class: \"btn btn-primary\"\n  }, {\n    default: _withCtx(() => [...(_cache[1] || (_cache[1] = [_createTextVNode(\"去逛逛\", -1 /* CACHED */)]))]),\n    _: 1 /* STABLE */\n  })])) : _createCommentVNode(\"v-if\", true), _createCommentVNode(\" 消息列表 \"), !$data.loading && $data.conversations.length > 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, [_createCommentVNode(\" 单个聊天会话 \"), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.conversations, conv => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      class: \"list-group-item list-group-item-action d-flex gap-3 p-3 cursor-pointer\",\n      key: conv.other_user_id,\n      onClick: $event => $options.goToChat(conv.other_user_id, conv.last_item_id)\n    }, [_createCommentVNode(\" 对方头像（用用户名首字母） \"), _createElementVNode(\"div\", _hoisted_6, _toDisplayString(conv.other_username.charAt(0).toUpperCase()), 1 /* TEXT */), _createCommentVNode(\" 消息内容 \"), _createElementVNode(\"div\", _hoisted_7, [_createElementVNode(\"div\", _hoisted_8, [_createElementVNode(\"h6\", _hoisted_9, _toDisplayString(conv.other_username), 1 /* TEXT */), _createElementVNode(\"small\", _hoisted_10, _toDisplayString($options.formatTime(conv.last_time)), 1 /* TEXT */)]), _createElementVNode(\"p\", _hoisted_11, _toDisplayString(conv.last_sender === 'me' ? '我：' : '') + _toDisplayString(conv.last_content), 1 /* TEXT */)]), _createCommentVNode(\" 未读消息提示 \"), conv.unread_count > 0 ? (_openBlock(), _createElementBlock(\"span\", _hoisted_12, _toDisplayString(conv.unread_count), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true)], 8 /* PROPS */, _hoisted_5);\n  }), 128 /* KEYED_FRAGMENT */))])) : _createCommentVNode(\"v-if\", true)]);\n}","map":{"version":3,"names":["class","style","_createElementBlock","_hoisted_1","_createCommentVNode","$data","loading","_hoisted_2","_cache","_createElementVNode","role","conversations","length","_hoisted_3","_createVNode","_component_router_link","to","_hoisted_4","_Fragment","_renderList","conv","key","other_user_id","onClick","$event","$options","goToChat","last_item_id","_hoisted_6","_toDisplayString","other_username","charAt","toUpperCase","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","formatTime","last_time","_hoisted_11","last_sender","last_content","unread_count","_hoisted_12"],"sources":["D:\\21626\\MyFiles\\files\\2025fall\\SE\\Vue_2\\frontend\\src\\views\\Messages.vue"],"sourcesContent":["<template>\n  <div class=\"container\">\n    <!-- 加载中提示 -->\n    <div v-if=\"loading\" class=\"text-center py-5\">\n      <div class=\"spinner-border text-primary\" role=\"status\">\n        <span class=\"visually-hidden\">Loading...</span>\n      </div>\n    </div>\n\n    <!-- 页面标题 -->\n    <h2 class=\"my-4\">我的消息</h2>\n\n    <!-- 没有消息时显示 -->\n    <div v-if=\"!loading && conversations.length === 0\" class=\"text-center py-5\">\n      <p class=\"text-muted\">你还没有任何消息</p>\n      <router-link to=\"/\" class=\"btn btn-primary\">去逛逛</router-link>\n    </div>\n\n    <!-- 消息列表 -->\n    <div class=\"list-group\" v-if=\"!loading && conversations.length > 0\">\n      <!-- 单个聊天会话 -->\n      <div \n        class=\"list-group-item list-group-item-action d-flex gap-3 p-3 cursor-pointer\"\n        v-for=\"conv in conversations\" \n        :key=\"conv.other_user_id\"\n        @click=\"goToChat(conv.other_user_id, conv.last_item_id)\"\n      >\n        <!-- 对方头像（用用户名首字母） -->\n        <div class=\"avatar bg-primary text-white rounded-circle d-flex align-items-center justify-content-center\" style=\"width: 50px; height: 50px; flex-shrink: 0;\">\n          {{ conv.other_username.charAt(0).toUpperCase() }}\n        </div>\n\n        <!-- 消息内容 -->\n        <div class=\"flex-grow-1 min-w-0\">\n          <div class=\"d-flex justify-content-between align-items-center mb-1\">\n            <h6 class=\"mb-0\">{{ conv.other_username }}</h6>\n            <small class=\"text-muted\">{{ formatTime(conv.last_time) }}</small>\n          </div>\n          <p class=\"mb-0 text-truncate\">\n            {{ conv.last_sender === 'me' ? '我：' : '' }}{{ conv.last_content }}\n          </p>\n        </div>\n\n        <!-- 未读消息提示 -->\n        <span v-if=\"conv.unread_count > 0\" class=\"badge bg-danger align-self-start\">\n          {{ conv.unread_count }}\n        </span>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios'\n\nexport default {\n  data() {\n    return {\n      loading: true,               // 加载状态\n      conversations: []            // 消息会话列表\n    }\n  },\n  created() {\n    // 页面加载时获取消息列表\n    this.getConversations();\n  },\n  methods: {\n    // 获取消息会话列表\n    async getConversations() {\n      try {\n        // 调用后端接口获取消息列表\n        const response = await axios.get('/api/messages/conversations');\n        if (response.data.ok) {\n          this.conversations = response.data.data;\n        } else {\n          alert(response.data.message || '获取消息列表失败');\n        }\n      } catch (error) {\n        console.error('获取消息列表失败:', error);\n        // 后端接口未实现时，用模拟数据显示\n        this.conversations = [\n          {\n            other_user_id: 2,\n            other_username: '卖家A',\n            last_item_id: 1, // 最后一条消息关联的商品ID\n            last_time: '2025-10-28 10:30',\n            last_sender: 'other', // 最后一条消息发送者（me/other）\n            last_content: '这个商品还在吗？',\n            unread_count: 1 // 未读消息数量\n          },\n          {\n            other_user_id: 3,\n            other_username: '买家B',\n            last_item_id: 2,\n            last_time: '2025-10-27 16:45',\n            last_sender: 'me',\n            last_content: '最低200元出，不议价',\n            unread_count: 0\n          }\n        ];\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    // 格式化时间（简化版）\n    formatTime(timeStr) {\n      // 实际项目中可根据需要格式化（如：今天/昨天/具体日期）\n      return timeStr;\n    },\n\n    // 进入与该用户的聊天界面\n    goToChat(otherUserId, itemId) {\n      this.$router.push({\n        name: 'ChatDetail',\n        params: {\n          otherUserId: otherUserId,\n          itemId: itemId\n        }\n      });\n    }\n  }\n}\n</script>\n\n<style>\n/* 头像样式 */\n.avatar {\n  font-weight: bold;\n}\n\n/* 消息列表项悬停效果 */\n.list-group-item:hover {\n  background-color: #f8f9fa;\n}\n</style>"],"mappings":";;EACOA,KAAK,EAAC;AAAW;;;EAEAA,KAAK,EAAC;;;;EAUyBA,KAAK,EAAC;;;;EAMpDA,KAAK,EAAC;;;;EASFA,KAAK,EAAC,8FAA8F;EAACC,KAAkD,EAAlD;IAAA;IAAA;IAAA;EAAA;;;EAKrGD,KAAK,EAAC;AAAqB;;EACzBA,KAAK,EAAC;AAAwD;;EAC7DA,KAAK,EAAC;AAAM;;EACTA,KAAK,EAAC;AAAY;;EAExBA,KAAK,EAAC;AAAoB;;;EAMIA,KAAK,EAAC;;;;uBA3C/CE,mBAAA,CAgDM,OAhDNC,UAgDM,GA/CJC,mBAAA,WAAc,EACHC,KAAA,CAAAC,OAAO,I,cAAlBJ,mBAAA,CAIM,OAJNK,UAIM,OAAAC,MAAA,QAAAA,MAAA,OAHJC,mBAAA,CAEM;IAFDT,KAAK,EAAC,6BAA6B;IAACU,IAAI,EAAC;MAC5CD,mBAAA,CAA+C;IAAzCT,KAAK,EAAC;EAAiB,GAAC,YAAU,E,8DAI5CI,mBAAA,UAAa,E,0BACbK,mBAAA,CAA0B;IAAtBT,KAAK,EAAC;EAAM,GAAC,MAAI,qBAErBI,mBAAA,aAAgB,E,CACJC,KAAA,CAAAC,OAAO,IAAID,KAAA,CAAAM,aAAa,CAACC,MAAM,U,cAA3CV,mBAAA,CAGM,OAHNW,UAGM,G,0BAFJJ,mBAAA,CAAkC;IAA/BT,KAAK,EAAC;EAAY,GAAC,UAAQ,qBAC9Bc,YAAA,CAA6DC,sBAAA;IAAhDC,EAAE,EAAC,GAAG;IAAChB,KAAK,EAAC;;sBAAkB,MAAG,KAAAQ,MAAA,QAAAA,MAAA,O,iBAAH,KAAG,mB;;6CAGjDJ,mBAAA,UAAa,E,CACkBC,KAAA,CAAAC,OAAO,IAAID,KAAA,CAAAM,aAAa,CAACC,MAAM,Q,cAA9DV,mBAAA,CA6BM,OA7BNe,UA6BM,GA5BJb,mBAAA,YAAe,G,kBACfF,mBAAA,CA0BMgB,SAAA,QAAAC,WAAA,CAxBWd,KAAA,CAAAM,aAAa,EAArBS,IAAI;yBAFblB,mBAAA,CA0BM;MAzBJF,KAAK,EAAC,wEAAwE;MAE7EqB,GAAG,EAAED,IAAI,CAACE,aAAa;MACvBC,OAAK,EAAAC,MAAA,IAAEC,QAAA,CAAAC,QAAQ,CAACN,IAAI,CAACE,aAAa,EAAEF,IAAI,CAACO,YAAY;QAEtDvB,mBAAA,mBAAsB,EACtBK,mBAAA,CAEM,OAFNmB,UAEM,EAAAC,gBAAA,CADDT,IAAI,CAACU,cAAc,CAACC,MAAM,IAAIC,WAAW,oBAG9C5B,mBAAA,UAAa,EACbK,mBAAA,CAQM,OARNwB,UAQM,GAPJxB,mBAAA,CAGM,OAHNyB,UAGM,GAFJzB,mBAAA,CAA+C,MAA/C0B,UAA+C,EAAAN,gBAAA,CAA3BT,IAAI,CAACU,cAAc,kBACvCrB,mBAAA,CAAkE,SAAlE2B,WAAkE,EAAAP,gBAAA,CAArCJ,QAAA,CAAAY,UAAU,CAACjB,IAAI,CAACkB,SAAS,kB,GAExD7B,mBAAA,CAEI,KAFJ8B,WAEI,EAAAV,gBAAA,CADCT,IAAI,CAACoB,WAAW,yBAAAX,gBAAA,CAA2BT,IAAI,CAACqB,YAAY,iB,GAInErC,mBAAA,YAAe,EACHgB,IAAI,CAACsB,YAAY,Q,cAA7BxC,mBAAA,CAEO,QAFPyC,WAEO,EAAAd,gBAAA,CADFT,IAAI,CAACsB,YAAY,oB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}