{"ast":null,"code":"import { createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, createTextVNode as _createTextVNode, vModelText as _vModelText, withDirectives as _withDirectives, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, withModifiers as _withModifiers } from \"vue\";\nconst _hoisted_1 = {\n  class: \"container\"\n};\nconst _hoisted_2 = {\n  class: \"row justify-content-center\"\n};\nconst _hoisted_3 = {\n  class: \"col-md-8\"\n};\nconst _hoisted_4 = {\n  class: \"card\"\n};\nconst _hoisted_5 = {\n  class: \"card-body\"\n};\nconst _hoisted_6 = {\n  class: \"mb-3\"\n};\nconst _hoisted_7 = {\n  class: \"mb-3\"\n};\nconst _hoisted_8 = {\n  class: \"mb-3\"\n};\nconst _hoisted_9 = {\n  class: \"mb-3\"\n};\nconst _hoisted_10 = {\n  key: 0,\n  class: \"mt-2\"\n};\nconst _hoisted_11 = [\"src\"];\nconst _hoisted_12 = [\"disabled\"];\nconst _hoisted_13 = {\n  key: 0,\n  class: \"spinner-border spinner-border-sm me-2\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, [_createElementVNode(\"div\", _hoisted_4, [_cache[9] || (_cache[9] = _createElementVNode(\"div\", {\n    class: \"card-header bg-primary text-white\"\n  }, [_createElementVNode(\"h3\", {\n    class: \"text-center\"\n  }, \"发布商品\")], -1 /* CACHED */)), _createElementVNode(\"div\", _hoisted_5, [_createElementVNode(\"form\", {\n    onSubmit: _cache[4] || (_cache[4] = _withModifiers((...args) => $options.handlePublish && $options.handlePublish(...args), [\"prevent\"]))\n  }, [_createCommentVNode(\" 商品标题 \"), _createElementVNode(\"div\", _hoisted_6, [_cache[5] || (_cache[5] = _createElementVNode(\"label\", {\n    for: \"title\",\n    class: \"form-label\"\n  }, [_createTextVNode(\"商品标题 \"), _createElementVNode(\"span\", {\n    class: \"text-danger\"\n  }, \"*\")], -1 /* CACHED */)), _withDirectives(_createElementVNode(\"input\", {\n    type: \"text\",\n    class: \"form-control\",\n    id: \"title\",\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $data.form.title = $event),\n    required: \"\",\n    placeholder: \"请输入商品标题（如：二手 textbooks）\",\n    maxlength: \"100\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $data.form.title]])]), _createCommentVNode(\" 商品价格 \"), _createElementVNode(\"div\", _hoisted_7, [_cache[6] || (_cache[6] = _createElementVNode(\"label\", {\n    for: \"price\",\n    class: \"form-label\"\n  }, [_createTextVNode(\"商品价格（元）\"), _createElementVNode(\"span\", {\n    class: \"text-danger\"\n  }, \"*\")], -1 /* CACHED */)), _withDirectives(_createElementVNode(\"input\", {\n    type: \"number\",\n    class: \"form-control\",\n    id: \"price\",\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $data.form.price = $event),\n    required: \"\",\n    min: \"0.01\",\n    step: \"0.01\",\n    placeholder: \"请输入价格\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $data.form.price]])]), _createCommentVNode(\" 商品描述 \"), _createElementVNode(\"div\", _hoisted_8, [_cache[7] || (_cache[7] = _createElementVNode(\"label\", {\n    for: \"description\",\n    class: \"form-label\"\n  }, [_createTextVNode(\"商品描述 \"), _createElementVNode(\"span\", {\n    class: \"text-danger\"\n  }, \"*\")], -1 /* CACHED */)), _withDirectives(_createElementVNode(\"textarea\", {\n    class: \"form-control\",\n    id: \"description\",\n    \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => $data.form.description = $event),\n    required: \"\",\n    rows: \"5\",\n    placeholder: \"请描述商品详情（新旧程度、使用情况等）\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $data.form.description]])]), _createCommentVNode(\" 商品图片（可选） \"), _createElementVNode(\"div\", _hoisted_9, [_cache[8] || (_cache[8] = _createElementVNode(\"label\", {\n    for: \"image\",\n    class: \"form-label\"\n  }, \"商品图片（可选）\", -1 /* CACHED */)), _createElementVNode(\"input\", {\n    type: \"file\",\n    class: \"form-control\",\n    id: \"image\",\n    accept: \"image/*\",\n    onChange: _cache[3] || (_cache[3] = (...args) => $options.handleImageUpload && $options.handleImageUpload(...args))\n  }, null, 32 /* NEED_HYDRATION */), _createCommentVNode(\" 预览选中的图片 \"), $data.imagePreview ? (_openBlock(), _createElementBlock(\"div\", _hoisted_10, [_createElementVNode(\"img\", {\n    src: $data.imagePreview,\n    class: \"img-thumbnail\",\n    style: {\n      \"max-width\": \"200px\"\n    },\n    alt: \"预览图\"\n  }, null, 8 /* PROPS */, _hoisted_11)])) : _createCommentVNode(\"v-if\", true)]), _createCommentVNode(\" 提交按钮 \"), _createElementVNode(\"button\", {\n    type: \"submit\",\n    class: \"btn btn-primary w-100\",\n    disabled: $data.submitting\n  }, [$data.submitting ? (_openBlock(), _createElementBlock(\"span\", _hoisted_13)) : _createCommentVNode(\"v-if\", true), _createTextVNode(\" \" + _toDisplayString($data.submitting ? '发布中...' : '发布商品'), 1 /* TEXT */)], 8 /* PROPS */, _hoisted_12)], 32 /* NEED_HYDRATION */)])])])])]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","onSubmit","_cache","_withModifiers","args","$options","handlePublish","_createCommentVNode","_hoisted_6","for","type","id","$data","form","title","$event","required","placeholder","maxlength","_hoisted_7","price","min","step","_hoisted_8","description","rows","_hoisted_9","accept","onChange","handleImageUpload","imagePreview","_hoisted_10","src","style","alt","disabled","submitting","_hoisted_13","_toDisplayString"],"sources":["D:\\21626\\MyFiles\\files\\2025fall\\SE\\Vue_2\\frontend\\src\\views\\Publish.vue"],"sourcesContent":["<template>\n  <div class=\"container\">\n    <div class=\"row justify-content-center\">\n      <div class=\"col-md-8\">\n        <div class=\"card\">\n          <div class=\"card-header bg-primary text-white\">\n            <h3 class=\"text-center\">发布商品</h3>\n          </div>\n          <div class=\"card-body\">\n            <form @submit.prevent=\"handlePublish\">\n              <!-- 商品标题 -->\n              <div class=\"mb-3\">\n                <label for=\"title\" class=\"form-label\">商品标题 <span class=\"text-danger\">*</span></label>\n                <input \n                  type=\"text\" \n                  class=\"form-control\" \n                  id=\"title\" \n                  v-model=\"form.title\" \n                  required\n                  placeholder=\"请输入商品标题（如：二手 textbooks）\"\n                  maxlength=\"100\"\n                >\n              </div>\n\n              <!-- 商品价格 -->\n              <div class=\"mb-3\">\n                <label for=\"price\" class=\"form-label\">商品价格（元）<span class=\"text-danger\">*</span></label>\n                <input \n                  type=\"number\" \n                  class=\"form-control\" \n                  id=\"price\" \n                  v-model=\"form.price\" \n                  required\n                  min=\"0.01\" \n                  step=\"0.01\"\n                  placeholder=\"请输入价格\"\n                >\n              </div>\n\n              <!-- 商品描述 -->\n              <div class=\"mb-3\">\n                <label for=\"description\" class=\"form-label\">商品描述 <span class=\"text-danger\">*</span></label>\n                <textarea \n                  class=\"form-control\" \n                  id=\"description\" \n                  v-model=\"form.description\" \n                  required\n                  rows=\"5\"\n                  placeholder=\"请描述商品详情（新旧程度、使用情况等）\"\n                ></textarea>\n              </div>\n\n              <!-- 商品图片（可选） -->\n              <div class=\"mb-3\">\n                <label for=\"image\" class=\"form-label\">商品图片（可选）</label>\n                <input \n                  type=\"file\" \n                  class=\"form-control\" \n                  id=\"image\" \n                  accept=\"image/*\"\n                  @change=\"handleImageUpload\"\n                >\n                <!-- 预览选中的图片 -->\n                <div v-if=\"imagePreview\" class=\"mt-2\">\n                  <img :src=\"imagePreview\" class=\"img-thumbnail\" style=\"max-width: 200px;\" alt=\"预览图\">\n                </div>\n              </div>\n\n              <!-- 提交按钮 -->\n              <button \n                type=\"submit\" \n                class=\"btn btn-primary w-100\" \n                :disabled=\"submitting\"\n              >\n                <span v-if=\"submitting\" class=\"spinner-border spinner-border-sm me-2\"></span>\n                {{ submitting ? '发布中...' : '发布商品' }}\n              </button>\n            </form>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios'\n\nexport default {\n  data() {\n    return {\n      // 表单数据\n      form: {\n        title: '',        // 商品标题\n        price: '',        // 商品价格\n        description: '',  // 商品描述\n        image: null       // 图片文件（不直接绑定v-model，通过change事件处理）\n      },\n      imagePreview: '',  // 图片预览地址\n      submitting: false  // 提交状态（防止重复提交）\n    }\n  },\n  methods: {\n    // 处理图片上传预览\n    handleImageUpload(e) {\n      const file = e.target.files[0];\n      if (!file) return;\n\n      // 限制图片大小（如不超过5MB）\n      if (file.size > 5 * 1024 * 1024) {\n        alert('图片大小不能超过5MB');\n        e.target.value = ''; // 清空选中的文件\n        return;\n      }\n\n      // 预览图片\n      const reader = new FileReader();\n      reader.onload = (event) => {\n        this.imagePreview = event.target.result;\n      };\n      reader.readAsDataURL(file);\n\n      // 保存文件到表单数据\n      this.form.image = file;\n    },\n\n    // 提交发布商品\n    async handlePublish() {\n      // 简单验证\n      if (!this.form.title.trim()) {\n        alert('请输入商品标题');\n        return;\n      }\n      if (!this.form.price || this.form.price < 0.01) {\n        alert('请输入有效的商品价格');\n        return;\n      }\n      if (!this.form.description.trim()) {\n        alert('请输入商品描述');\n        return;\n      }\n\n      this.submitting = true; // 开始提交，禁用按钮\n\n      try {\n        // 创建FormData对象（用于上传文件）\n        const formData = new FormData();\n        formData.append('title', this.form.title);\n        formData.append('price', this.form.price);\n        formData.append('description', this.form.description);\n        if (this.form.image) {\n          formData.append('image', this.form.image); // 图片文件\n        }\n\n        // 调用后端发布商品接口（暂时模拟，后续替换为真实请求）\n        const response = await axios.post('/api/items', formData, {\n          headers: {\n            'Content-Type': 'multipart/form-data' // 上传文件必须的头信息\n          }\n        });\n\n        if (response.data.ok) {\n          alert('商品发布成功！');\n          this.$router.push('/'); // 发布成功后跳回首页\n        } else {\n          alert(response.data.message || '发布失败，请重试');\n        }\n      } catch (error) {\n        console.error('发布商品失败:', error);\n        alert('网络错误，请稍后再试');\n      } finally {\n        this.submitting = false; // 结束提交，启用按钮\n      }\n    }\n  }\n}\n</script>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}