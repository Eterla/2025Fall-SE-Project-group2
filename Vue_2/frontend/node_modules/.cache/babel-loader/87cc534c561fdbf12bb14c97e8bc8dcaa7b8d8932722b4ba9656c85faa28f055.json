{"ast":null,"code":"import { createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, withModifiers as _withModifiers, normalizeClass as _normalizeClass } from \"vue\";\nconst _hoisted_1 = {\n  class: \"container\"\n};\nconst _hoisted_2 = {\n  class: \"card mt-5\"\n};\nconst _hoisted_3 = {\n  class: \"card-body\"\n};\nconst _hoisted_4 = {\n  key: 0,\n  class: \"list-group\"\n};\nconst _hoisted_5 = [\"onClick\"];\nconst _hoisted_6 = {\n  class: \"d-flex w-100 justify-content-between\"\n};\nconst _hoisted_7 = {\n  class: \"mb-1\"\n};\nconst _hoisted_8 = {\n  class: \"mb-1\"\n};\nconst _hoisted_9 = {\n  class: \"d-flex w-100 justify-content-between\"\n};\nconst _hoisted_10 = [\"src\", \"alt\"];\nconst _hoisted_11 = {\n  key: 0,\n  class: \"badge bg-primary\"\n};\nconst _hoisted_12 = {\n  key: 1,\n  class: \"alert alert-info text-center py-5\"\n};\nconst _hoisted_13 = {\n  key: 2,\n  class: \"text-center py-5\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_cache[2] || (_cache[2] = _createElementVNode(\"div\", {\n    class: \"card-header bg-primary text-white\"\n  }, [_createElementVNode(\"h4\", {\n    class: \"mb-0\"\n  }, \"我的消息\")], -1 /* CACHED */)), _createElementVNode(\"div\", _hoisted_3, [_createCommentVNode(\" 消息列表 \"), $data.conversations.length > 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.conversations, conv => {\n    return _openBlock(), _createElementBlock(\"a\", {\n      href: \"#\",\n      class: _normalizeClass([\"list-group-item list-group-item-action flex-column align-items-start\", conv.unread_count > 0 ? 'active' : '']),\n      key: `${conv.other_user_id}-${conv.item_id}`,\n      onClick: _withModifiers($event => $options.goToChat(conv), [\"prevent\"])\n    }, [_createElementVNode(\"div\", _hoisted_6, [_createElementVNode(\"h5\", _hoisted_7, _toDisplayString(conv.other_username), 1 /* TEXT */), _createElementVNode(\"small\", null, _toDisplayString($options.formatDate(conv.last_message_time)), 1 /* TEXT */)]), _createElementVNode(\"p\", _hoisted_8, _toDisplayString(conv.item_title), 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_9, [_createElementVNode(\"small\", null, [_createElementVNode(\"img\", {\n      src: conv.item_image ? `/static/${conv.item_image}` : '/static/images/default.jpg',\n      class: \"rounded-circle\",\n      style: {\n        \"width\": \"40px\",\n        \"height\": \"40px\",\n        \"object-fit\": \"cover\"\n      },\n      alt: conv.item_title\n    }, null, 8 /* PROPS */, _hoisted_10)]), conv.unread_count > 0 ? (_openBlock(), _createElementBlock(\"span\", _hoisted_11, _toDisplayString(conv.unread_count), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true)])], 10 /* CLASS, PROPS */, _hoisted_5);\n  }), 128 /* KEYED_FRAGMENT */))])) : !$data.loading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_12, [...(_cache[0] || (_cache[0] = [_createElementVNode(\"i\", {\n    class: \"fas fa-comment text-primary fa-3x mb-3\"\n  }, null, -1 /* CACHED */), _createElementVNode(\"p\", null, \"暂无消息\", -1 /* CACHED */), _createElementVNode(\"p\", {\n    class: \"text-muted\"\n  }, \"浏览商品并联系卖家开始聊天吧\", -1 /* CACHED */)]))])) : (_openBlock(), _createElementBlock(\"div\", _hoisted_13, [...(_cache[1] || (_cache[1] = [_createElementVNode(\"div\", {\n    class: \"spinner-border text-primary\",\n    role: \"status\"\n  }, [_createElementVNode(\"span\", {\n    class: \"sr-only\"\n  }, \"Loading...\")], -1 /* CACHED */), _createElementVNode(\"p\", {\n    class: \"mt-2\"\n  }, \"加载中...\", -1 /* CACHED */)]))]))])])]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_createCommentVNode","$data","conversations","length","_hoisted_4","_Fragment","_renderList","conv","href","_normalizeClass","unread_count","key","other_user_id","item_id","onClick","_withModifiers","$event","$options","goToChat","_hoisted_6","_hoisted_7","_toDisplayString","other_username","formatDate","last_message_time","_hoisted_8","item_title","_hoisted_9","src","item_image","style","alt","_hoisted_11","loading","_hoisted_12","_cache","_hoisted_13","role"],"sources":["D:\\21626\\MyFiles\\files\\2025fall\\SE\\Vue_2\\frontend\\src\\views\\Messages.vue"],"sourcesContent":["<template>\n  <div class=\"container\">\n    <div class=\"card mt-5\">\n      <div class=\"card-header bg-primary text-white\">\n        <h4 class=\"mb-0\">我的消息</h4>\n      </div>\n      <div class=\"card-body\">\n        <!-- 消息列表 -->\n        <div class=\"list-group\" v-if=\"conversations.length > 0\">\n          <a \n            href=\"#\" \n            class=\"list-group-item list-group-item-action flex-column align-items-start\"\n            v-for=\"conv in conversations\" \n            :key=\"`${conv.other_user_id}-${conv.item_id}`\"\n            @click.prevent=\"goToChat(conv)\"\n            :class=\"conv.unread_count > 0 ? 'active' : ''\"\n          >\n            <div class=\"d-flex w-100 justify-content-between\">\n              <h5 class=\"mb-1\">{{ conv.other_username }}</h5>\n              <small>{{ formatDate(conv.last_message_time) }}</small>\n            </div>\n            <p class=\"mb-1\">{{ conv.item_title }}</p>\n            <div class=\"d-flex w-100 justify-content-between\">\n              <small>\n                <img \n                  :src=\"conv.item_image ? `/static/${conv.item_image}` : '/static/images/default.jpg'\" \n                  class=\"rounded-circle\" \n                  style=\"width: 40px; height: 40px; object-fit: cover;\"\n                  :alt=\"conv.item_title\"\n                >\n              </small>\n              <span class=\"badge bg-primary\" v-if=\"conv.unread_count > 0\">{{ conv.unread_count }}</span>\n            </div>\n          </a>\n        </div>\n        \n        <div class=\"alert alert-info text-center py-5\" v-else-if=\"!loading\">\n          <i class=\"fas fa-comment text-primary fa-3x mb-3\"></i>\n          <p>暂无消息</p>\n          <p class=\"text-muted\">浏览商品并联系卖家开始聊天吧</p>\n        </div>\n        \n        <div class=\"text-center py-5\" v-else>\n          <div class=\"spinner-border text-primary\" role=\"status\">\n            <span class=\"sr-only\">Loading...</span>\n          </div>\n          <p class=\"mt-2\">加载中...</p>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from '../axios';\n\nexport default {\n  data() {\n    return {\n      conversations: [],\n      loading: true\n    };\n  },\n  mounted() {\n    this.loadConversations();\n  },\n  methods: {\n    async loadConversations() {\n      this.loading = true;\n      try {\n        const res = await axios.get('/messages/conversations');\n        if (res.ok) {\n          this.conversations = res.data;\n        }\n      } catch (error) {\n        console.error('加载消息列表失败', error);\n        this.$message.error('加载消息列表失败');\n      } finally {\n        this.loading = false;\n      }\n    },\n    goToChat(conv) {\n      this.$router.push({\n        name: 'ChatDetail',\n        params: {\n          otherUserId: conv.other_user_id,\n          itemId: conv.item_id\n        }\n      });\n    },\n    formatDate(dateString) {\n      if (!dateString) return '';\n      const date = new Date(dateString);\n      return date.toLocaleString();\n    }\n  }\n};\n</script>\n\n<style scoped>\n.list-group-item {\n  transition: background-color 0.2s;\n}\n.list-group-item:hover {\n  background-color: #f8f9fa;\n}\n.list-group-item.active {\n  border-color: #007bff;\n}\n</style>\n"],"mappings":";;EACOA,KAAK,EAAC;AAAW;;EACfA,KAAK,EAAC;AAAW;;EAIfA,KAAK,EAAC;AAAW;;;EAEfA,KAAK,EAAC;;;;EASFA,KAAK,EAAC;AAAsC;;EAC3CA,KAAK,EAAC;AAAM;;EAGfA,KAAK,EAAC;AAAM;;EACVA,KAAK,EAAC;AAAsC;;;;EASzCA,KAAK,EAAC;;;;EAKbA,KAAK,EAAC;;;;EAMNA,KAAK,EAAC;;;uBAzCjBC,mBAAA,CAiDM,OAjDNC,UAiDM,GAhDJC,mBAAA,CA+CM,OA/CNC,UA+CM,G,0BA9CJD,mBAAA,CAEM;IAFDH,KAAK,EAAC;EAAmC,IAC5CG,mBAAA,CAA0B;IAAtBH,KAAK,EAAC;EAAM,GAAC,MAAI,E,qBAEvBG,mBAAA,CA0CM,OA1CNE,UA0CM,GAzCJC,mBAAA,UAAa,EACiBC,KAAA,CAAAC,aAAa,CAACC,MAAM,Q,cAAlDR,mBAAA,CA0BM,OA1BNS,UA0BM,I,kBAzBJT,mBAAA,CAwBIU,SAAA,QAAAC,WAAA,CArBaL,KAAA,CAAAC,aAAa,EAArBK,IAAI;yBAHbZ,mBAAA,CAwBI;MAvBFa,IAAI,EAAC,GAAG;MACRd,KAAK,EAAAe,eAAA,EAAC,sEAAsE,EAIpEF,IAAI,CAACG,YAAY;MAFxBC,GAAG,KAAKJ,IAAI,CAACK,aAAa,IAAIL,IAAI,CAACM,OAAO;MAC1CC,OAAK,EAAAC,cAAA,CAAAC,MAAA,IAAUC,QAAA,CAAAC,QAAQ,CAACX,IAAI;QAG7BV,mBAAA,CAGM,OAHNsB,UAGM,GAFJtB,mBAAA,CAA+C,MAA/CuB,UAA+C,EAAAC,gBAAA,CAA3Bd,IAAI,CAACe,cAAc,kBACvCzB,mBAAA,CAAuD,eAAAwB,gBAAA,CAA7CJ,QAAA,CAAAM,UAAU,CAAChB,IAAI,CAACiB,iBAAiB,kB,GAE7C3B,mBAAA,CAAyC,KAAzC4B,UAAyC,EAAAJ,gBAAA,CAAtBd,IAAI,CAACmB,UAAU,kBAClC7B,mBAAA,CAUM,OAVN8B,UAUM,GATJ9B,mBAAA,CAOQ,gBANNA,mBAAA,CAKC;MAJE+B,GAAG,EAAErB,IAAI,CAACsB,UAAU,cAActB,IAAI,CAACsB,UAAU;MAClDnC,KAAK,EAAC,gBAAgB;MACtBoC,KAAqD,EAArD;QAAA;QAAA;QAAA;MAAA,CAAqD;MACpDC,GAAG,EAAExB,IAAI,CAACmB;4CAGsBnB,IAAI,CAACG,YAAY,Q,cAAtDf,mBAAA,CAA0F,QAA1FqC,WAA0F,EAAAX,gBAAA,CAA3Bd,IAAI,CAACG,YAAY,oB;uCAK3BT,KAAA,CAAAgC,OAAO,I,cAAlEtC,mBAAA,CAIM,OAJNuC,WAIM,OAAAC,MAAA,QAAAA,MAAA,OAHJtC,mBAAA,CAAsD;IAAnDH,KAAK,EAAC;EAAwC,2BACjDG,mBAAA,CAAW,WAAR,MAAI,oBACPA,mBAAA,CAAwC;IAArCH,KAAK,EAAC;EAAY,GAAC,gBAAc,mB,uBAGtCC,mBAAA,CAKM,OALNyC,WAKM,OAAAD,MAAA,QAAAA,MAAA,OAJJtC,mBAAA,CAEM;IAFDH,KAAK,EAAC,6BAA6B;IAAC2C,IAAI,EAAC;MAC5CxC,mBAAA,CAAuC;IAAjCH,KAAK,EAAC;EAAS,GAAC,YAAU,E,oBAElCG,mBAAA,CAA0B;IAAvBH,KAAK,EAAC;EAAM,GAAC,QAAM,mB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}