{"ast":null,"code":"import axios from '../axios';\nexport default {\n  data() {\n    return {\n      conversations: [],\n      loading: true\n    };\n  },\n  mounted() {\n    this.loadConversations();\n  },\n  methods: {\n    async loadConversations() {\n      this.loading = true;\n      try {\n        const res = await axios.get('/messages/conversations');\n        if (res.ok) {\n          this.conversations = res.data;\n        }\n      } catch (error) {\n        console.error('加载消息列表失败', error);\n        this.$message.error('加载消息列表失败');\n      } finally {\n        this.loading = false;\n      }\n    },\n    goToChat(conv) {\n      this.$router.push({\n        name: 'ChatDetail',\n        params: {\n          otherUserId: conv.other_user_id,\n          itemId: conv.item_id\n        }\n      });\n    },\n    formatDate(dateString) {\n      if (!dateString) return '';\n      const date = new Date(dateString);\n      return date.toLocaleString();\n    }\n  }\n};","map":{"version":3,"names":["axios","data","conversations","loading","mounted","loadConversations","methods","res","get","ok","error","console","$message","goToChat","conv","$router","push","name","params","otherUserId","other_user_id","itemId","item_id","formatDate","dateString","date","Date","toLocaleString"],"sources":["D:\\21626\\MyFiles\\files\\2025fall\\SE\\Vue_2\\frontend\\src\\views\\Messages.vue"],"sourcesContent":["<template>\n  <div class=\"container\">\n    <div class=\"card mt-5\">\n      <div class=\"card-header bg-primary text-white\">\n        <h4 class=\"mb-0\">我的消息</h4>\n      </div>\n      <div class=\"card-body\">\n        <!-- 消息列表 -->\n        <div class=\"list-group\" v-if=\"conversations.length > 0\">\n          <a \n            href=\"#\" \n            class=\"list-group-item list-group-item-action flex-column align-items-start\"\n            v-for=\"conv in conversations\" \n            :key=\"`${conv.other_user_id}-${conv.item_id}`\"\n            @click.prevent=\"goToChat(conv)\"\n            :class=\"conv.unread_count > 0 ? 'active' : ''\"\n          >\n            <div class=\"d-flex w-100 justify-content-between\">\n              <h5 class=\"mb-1\">{{ conv.other_username }}</h5>\n              <small>{{ formatDate(conv.last_message_time) }}</small>\n            </div>\n            <p class=\"mb-1\">{{ conv.item_title }}</p>\n            <div class=\"d-flex w-100 justify-content-between\">\n              <small>\n                <img \n                  :src=\"conv.item_image ? `/static/${conv.item_image}` : '/static/images/default.jpg'\" \n                  class=\"rounded-circle\" \n                  style=\"width: 40px; height: 40px; object-fit: cover;\"\n                  :alt=\"conv.item_title\"\n                >\n              </small>\n              <span class=\"badge bg-primary\" v-if=\"conv.unread_count > 0\">{{ conv.unread_count }}</span>\n            </div>\n          </a>\n        </div>\n        \n        <div class=\"alert alert-info text-center py-5\" v-else-if=\"!loading\">\n          <i class=\"fas fa-comment text-primary fa-3x mb-3\"></i>\n          <p>暂无消息</p>\n          <p class=\"text-muted\">浏览商品并联系卖家开始聊天吧</p>\n        </div>\n        \n        <div class=\"text-center py-5\" v-else>\n          <div class=\"spinner-border text-primary\" role=\"status\">\n            <span class=\"sr-only\">Loading...</span>\n          </div>\n          <p class=\"mt-2\">加载中...</p>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from '../axios';\n\nexport default {\n  data() {\n    return {\n      conversations: [],\n      loading: true\n    };\n  },\n  mounted() {\n    this.loadConversations();\n  },\n  methods: {\n    async loadConversations() {\n      this.loading = true;\n      try {\n        const res = await axios.get('/messages/conversations');\n        if (res.ok) {\n          this.conversations = res.data;\n        }\n      } catch (error) {\n        console.error('加载消息列表失败', error);\n        this.$message.error('加载消息列表失败');\n      } finally {\n        this.loading = false;\n      }\n    },\n    goToChat(conv) {\n      this.$router.push({\n        name: 'ChatDetail',\n        params: {\n          otherUserId: conv.other_user_id,\n          itemId: conv.item_id\n        }\n      });\n    },\n    formatDate(dateString) {\n      if (!dateString) return '';\n      const date = new Date(dateString);\n      return date.toLocaleString();\n    }\n  }\n};\n</script>\n\n<style scoped>\n.list-group-item {\n  transition: background-color 0.2s;\n}\n.list-group-item:hover {\n  background-color: #f8f9fa;\n}\n.list-group-item.active {\n  border-color: #007bff;\n}\n</style>\n"],"mappings":"AAsDA,OAAOA,KAAI,MAAO,UAAU;AAE5B,eAAe;EACbC,IAAIA,CAAA,EAAG;IACL,OAAO;MACLC,aAAa,EAAE,EAAE;MACjBC,OAAO,EAAE;IACX,CAAC;EACH,CAAC;EACDC,OAAOA,CAAA,EAAG;IACR,IAAI,CAACC,iBAAiB,CAAC,CAAC;EAC1B,CAAC;EACDC,OAAO,EAAE;IACP,MAAMD,iBAAiBA,CAAA,EAAG;MACxB,IAAI,CAACF,OAAM,GAAI,IAAI;MACnB,IAAI;QACF,MAAMI,GAAE,GAAI,MAAMP,KAAK,CAACQ,GAAG,CAAC,yBAAyB,CAAC;QACtD,IAAID,GAAG,CAACE,EAAE,EAAE;UACV,IAAI,CAACP,aAAY,GAAIK,GAAG,CAACN,IAAI;QAC/B;MACF,EAAE,OAAOS,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,UAAU,EAAEA,KAAK,CAAC;QAChC,IAAI,CAACE,QAAQ,CAACF,KAAK,CAAC,UAAU,CAAC;MACjC,UAAU;QACR,IAAI,CAACP,OAAM,GAAI,KAAK;MACtB;IACF,CAAC;IACDU,QAAQA,CAACC,IAAI,EAAE;MACb,IAAI,CAACC,OAAO,CAACC,IAAI,CAAC;QAChBC,IAAI,EAAE,YAAY;QAClBC,MAAM,EAAE;UACNC,WAAW,EAAEL,IAAI,CAACM,aAAa;UAC/BC,MAAM,EAAEP,IAAI,CAACQ;QACf;MACF,CAAC,CAAC;IACJ,CAAC;IACDC,UAAUA,CAACC,UAAU,EAAE;MACrB,IAAI,CAACA,UAAU,EAAE,OAAO,EAAE;MAC1B,MAAMC,IAAG,GAAI,IAAIC,IAAI,CAACF,UAAU,CAAC;MACjC,OAAOC,IAAI,CAACE,cAAc,CAAC,CAAC;IAC9B;EACF;AACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}