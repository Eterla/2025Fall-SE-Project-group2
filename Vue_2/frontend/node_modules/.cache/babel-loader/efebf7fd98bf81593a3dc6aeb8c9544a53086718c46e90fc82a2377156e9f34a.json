{"ast":null,"code":"import { createElementVNode as _createElementVNode, vModelText as _vModelText, withDirectives as _withDirectives, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, createTextVNode as _createTextVNode, withModifiers as _withModifiers } from \"vue\";\nconst _hoisted_1 = {\n  class: \"container\"\n};\nconst _hoisted_2 = {\n  class: \"row justify-content-center\"\n};\nconst _hoisted_3 = {\n  class: \"col-md-8\"\n};\nconst _hoisted_4 = {\n  class: \"card mt-5\"\n};\nconst _hoisted_5 = {\n  class: \"card-body\"\n};\nconst _hoisted_6 = {\n  class: \"form-group\"\n};\nconst _hoisted_7 = {\n  class: \"form-group\"\n};\nconst _hoisted_8 = {\n  class: \"form-group\"\n};\nconst _hoisted_9 = {\n  class: \"form-group\"\n};\nconst _hoisted_10 = {\n  class: \"form-group\"\n};\nconst _hoisted_11 = {\n  key: 0,\n  class: \"mt-2\"\n};\nconst _hoisted_12 = [\"src\"];\nconst _hoisted_13 = [\"disabled\"];\nconst _hoisted_14 = {\n  key: 0,\n  class: \"spinner-border spinner-border-sm mr-2\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, [_createElementVNode(\"div\", _hoisted_4, [_cache[12] || (_cache[12] = _createElementVNode(\"div\", {\n    class: \"card-header bg-primary text-white\"\n  }, [_createElementVNode(\"h4\", {\n    class: \"mb-0\"\n  }, \"发布商品\")], -1 /* CACHED */)), _createElementVNode(\"div\", _hoisted_5, [_createElementVNode(\"form\", {\n    onSubmit: _cache[5] || (_cache[5] = _withModifiers((...args) => $options.handleSubmit && $options.handleSubmit(...args), [\"prevent\"])),\n    enctype: \"multipart/form-data\"\n  }, [_createElementVNode(\"div\", _hoisted_6, [_cache[6] || (_cache[6] = _createElementVNode(\"label\", {\n    for: \"title\"\n  }, \"商品标题\", -1 /* CACHED */)), _withDirectives(_createElementVNode(\"input\", {\n    type: \"text\",\n    id: \"title\",\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $data.title = $event),\n    class: \"form-control\",\n    required: \"\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $data.title]])]), _createElementVNode(\"div\", _hoisted_7, [_cache[7] || (_cache[7] = _createElementVNode(\"label\", {\n    for: \"price\"\n  }, \"价格（元）\", -1 /* CACHED */)), _withDirectives(_createElementVNode(\"input\", {\n    type: \"number\",\n    id: \"price\",\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $data.price = $event),\n    class: \"form-control\",\n    step: \"0.01\",\n    min: \"0\",\n    required: \"\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $data.price]])]), _createElementVNode(\"div\", _hoisted_8, [_cache[8] || (_cache[8] = _createElementVNode(\"label\", {\n    for: \"description\"\n  }, \"商品描述\", -1 /* CACHED */)), _withDirectives(_createElementVNode(\"textarea\", {\n    id: \"description\",\n    \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => $data.description = $event),\n    class: \"form-control\",\n    rows: \"5\",\n    required: \"\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $data.description]])]), _createElementVNode(\"div\", _hoisted_9, [_cache[9] || (_cache[9] = _createElementVNode(\"label\", {\n    for: \"tags\"\n  }, \"标签（用空格分隔）\", -1 /* CACHED */)), _withDirectives(_createElementVNode(\"input\", {\n    type: \"text\",\n    id: \"tags\",\n    \"onUpdate:modelValue\": _cache[3] || (_cache[3] = $event => $data.tags = $event),\n    class: \"form-control\",\n    placeholder: \"例如：书籍 教材 计算机\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $data.tags]])]), _createElementVNode(\"div\", _hoisted_10, [_cache[10] || (_cache[10] = _createElementVNode(\"label\", {\n    for: \"image\"\n  }, \"商品图片（可选）\", -1 /* CACHED */)), _createElementVNode(\"input\", {\n    type: \"file\",\n    id: \"image\",\n    class: \"form-control-file\",\n    onChange: _cache[4] || (_cache[4] = (...args) => $options.handleImageChange && $options.handleImageChange(...args)),\n    accept: \"image/*\"\n  }, null, 32 /* NEED_HYDRATION */), $data.imagePreview ? (_openBlock(), _createElementBlock(\"div\", _hoisted_11, [_createElementVNode(\"img\", {\n    src: $data.imagePreview,\n    class: \"img-thumbnail\",\n    style: {\n      \"max-height\": \"200px\"\n    }\n  }, null, 8 /* PROPS */, _hoisted_12)])) : _createCommentVNode(\"v-if\", true)]), _createElementVNode(\"button\", {\n    type: \"submit\",\n    class: \"btn btn-primary btn-block\",\n    disabled: $data.loading\n  }, [$data.loading ? (_openBlock(), _createElementBlock(\"span\", _hoisted_14)) : _createCommentVNode(\"v-if\", true), _cache[11] || (_cache[11] = _createTextVNode(\" 发布商品 \", -1 /* CACHED */))], 8 /* PROPS */, _hoisted_13)], 32 /* NEED_HYDRATION */)])])])])]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","onSubmit","_cache","_withModifiers","args","$options","handleSubmit","enctype","_hoisted_6","for","type","id","$data","title","$event","required","_hoisted_7","price","step","min","_hoisted_8","description","rows","_hoisted_9","tags","placeholder","_hoisted_10","onChange","handleImageChange","accept","imagePreview","_hoisted_11","src","style","disabled","loading","_hoisted_14"],"sources":["D:\\21626\\MyFiles\\files\\2025fall\\SE\\Vue_2\\frontend\\src\\views\\Publish.vue"],"sourcesContent":["<template>\n  <div class=\"container\">\n    <div class=\"row justify-content-center\">\n      <div class=\"col-md-8\">\n        <div class=\"card mt-5\">\n          <div class=\"card-header bg-primary text-white\">\n            <h4 class=\"mb-0\">发布商品</h4>\n          </div>\n          <div class=\"card-body\">\n            <form @submit.prevent=\"handleSubmit\" enctype=\"multipart/form-data\">\n              <div class=\"form-group\">\n                <label for=\"title\">商品标题</label>\n                <input \n                  type=\"text\" \n                  id=\"title\" \n                  v-model=\"title\" \n                  class=\"form-control\" \n                  required\n                >\n              </div>\n              \n              <div class=\"form-group\">\n                <label for=\"price\">价格（元）</label>\n                <input \n                  type=\"number\" \n                  id=\"price\" \n                  v-model=\"price\" \n                  class=\"form-control\" \n                  step=\"0.01\" \n                  min=\"0\" \n                  required\n                >\n              </div>\n              \n              <div class=\"form-group\">\n                <label for=\"description\">商品描述</label>\n                <textarea \n                  id=\"description\" \n                  v-model=\"description\" \n                  class=\"form-control\" \n                  rows=\"5\"\n                  required\n                ></textarea>\n              </div>\n              \n              <div class=\"form-group\">\n                <label for=\"tags\">标签（用空格分隔）</label>\n                <input \n                  type=\"text\" \n                  id=\"tags\" \n                  v-model=\"tags\" \n                  class=\"form-control\" \n                  placeholder=\"例如：书籍 教材 计算机\"\n                >\n              </div>\n              \n              <div class=\"form-group\">\n                <label for=\"image\">商品图片（可选）</label>\n                <input \n                  type=\"file\" \n                  id=\"image\" \n                  class=\"form-control-file\" \n                  @change=\"handleImageChange\"\n                  accept=\"image/*\"\n                >\n                <div class=\"mt-2\" v-if=\"imagePreview\">\n                  <img :src=\"imagePreview\" class=\"img-thumbnail\" style=\"max-height: 200px;\">\n                </div>\n              </div>\n              \n              <button \n                type=\"submit\" \n                class=\"btn btn-primary btn-block\" \n                :disabled=\"loading\"\n              >\n                <span v-if=\"loading\" class=\"spinner-border spinner-border-sm mr-2\"></span>\n                发布商品\n              </button>\n            </form>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from '../axios';\n\nexport default {\n  data() {\n    return {\n      title: '',\n      price: '',\n      description: '',\n      tags: '',\n      image: null,\n      imagePreview: null,\n      loading: false\n    };\n  },\n  methods: {\n    handleImageChange(e) {\n      const file = e.target.files[0];\n      if (file) {\n        this.image = file;\n        // 创建预览\n        const reader = new FileReader();\n        reader.onload = (e) => {\n          this.imagePreview = e.target.result;\n        };\n        reader.readAsDataURL(file);\n      }\n    },\n    async handleSubmit() {\n      if (!this.title || !this.price || !this.description) {\n        this.$message.error('请填写必填字段');\n        return;\n      }\n      \n      this.loading = true;\n      try {\n        // 创建FormData对象\n        const formData = new FormData();\n        formData.append('title', this.title);\n        formData.append('price', this.price);\n        formData.append('description', this.description);\n        formData.append('tags', this.tags);\n        \n        // 如果有图片，添加到FormData\n        if (this.image) {\n          formData.append('image', this.image);\n        }\n        \n        // 发送请求\n        const res = await axios.post('/items', formData, {\n          headers: {\n            'Content-Type': 'multipart/form-data'\n          }\n        });\n        \n        if (res.ok) {\n          this.$message.success('商品发布成功！');\n          // 重置表单\n          this.title = '';\n          this.price = '';\n          this.description = '';\n          this.tags = '';\n          this.image = null;\n          this.imagePreview = null;\n          \n          // 跳转到商品详情页\n          this.$router.push({\n            name: 'ItemDetail',\n            params: { id: res.data.id }\n          });\n        }\n      } catch (error) {\n        console.error('发布商品失败', error);\n        this.$message.error(error.error?.message || '发布商品失败，请稍后重试');\n      } finally {\n        this.loading = false;\n      }\n    }\n  }\n};\n</script>\n\n<style scoped>\n.card {\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\n}\n.card-header {\n  text-align: center;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}