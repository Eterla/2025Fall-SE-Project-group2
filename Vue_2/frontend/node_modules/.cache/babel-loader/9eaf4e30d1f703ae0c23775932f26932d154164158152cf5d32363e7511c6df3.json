{"ast":null,"code":"import axios from 'axios';\nexport default {\n  data() {\n    return {\n      // 表单数据\n      form: {\n        title: '',\n        // 商品标题\n        price: '',\n        // 商品价格\n        description: '',\n        // 商品描述\n        image: null // 图片文件（不直接绑定v-model，通过change事件处理）\n      },\n      imagePreview: '',\n      // 图片预览地址\n      submitting: false // 提交状态（防止重复提交）\n    };\n  },\n  methods: {\n    // 处理图片上传预览\n    handleImageUpload(e) {\n      const file = e.target.files[0];\n      if (!file) return;\n\n      // 限制图片大小（如不超过5MB）\n      if (file.size > 5 * 1024 * 1024) {\n        alert('图片大小不能超过5MB');\n        e.target.value = ''; // 清空选中的文件\n        return;\n      }\n\n      // 预览图片\n      const reader = new FileReader();\n      reader.onload = event => {\n        this.imagePreview = event.target.result;\n      };\n      reader.readAsDataURL(file);\n\n      // 保存文件到表单数据\n      this.form.image = file;\n    },\n    // 提交发布商品\n    async handlePublish() {\n      // 简单验证\n      if (!this.form.title.trim()) {\n        alert('请输入商品标题');\n        return;\n      }\n      if (!this.form.price || this.form.price < 0.01) {\n        alert('请输入有效的商品价格');\n        return;\n      }\n      if (!this.form.description.trim()) {\n        alert('请输入商品描述');\n        return;\n      }\n      this.submitting = true; // 开始提交，禁用按钮\n\n      try {\n        // 创建FormData对象（用于上传文件）\n        const formData = new FormData();\n        formData.append('title', this.form.title);\n        formData.append('price', this.form.price);\n        formData.append('description', this.form.description);\n        if (this.form.image) {\n          formData.append('image', this.form.image); // 图片文件\n        }\n\n        // 调用后端发布商品接口（暂时模拟，后续替换为真实请求）\n        const response = await axios.post('/api/items', formData, {\n          headers: {\n            'Content-Type': 'multipart/form-data' // 上传文件必须的头信息\n          }\n        });\n        if (response.data.ok) {\n          alert('商品发布成功！');\n          this.$router.push('/'); // 发布成功后跳回首页\n        } else {\n          alert(response.data.message || '发布失败，请重试');\n        }\n      } catch (error) {\n        console.error('发布商品失败:', error);\n        alert('网络错误，请稍后再试');\n      } finally {\n        this.submitting = false; // 结束提交，启用按钮\n      }\n    }\n  }\n};","map":{"version":3,"names":["axios","data","form","title","price","description","image","imagePreview","submitting","methods","handleImageUpload","e","file","target","files","size","alert","value","reader","FileReader","onload","event","result","readAsDataURL","handlePublish","trim","formData","FormData","append","response","post","headers","ok","$router","push","message","error","console"],"sources":["D:\\21626\\MyFiles\\files\\2025fall\\SE\\Vue_2\\frontend\\src\\views\\Publish.vue"],"sourcesContent":["<template>\n  <div class=\"container\">\n    <div class=\"row justify-content-center\">\n      <div class=\"col-md-8\">\n        <div class=\"card\">\n          <div class=\"card-header bg-primary text-white\">\n            <h3 class=\"text-center\">发布商品</h3>\n          </div>\n          <div class=\"card-body\">\n            <form @submit.prevent=\"handlePublish\">\n              <!-- 商品标题 -->\n              <div class=\"mb-3\">\n                <label for=\"title\" class=\"form-label\">商品标题 <span class=\"text-danger\">*</span></label>\n                <input \n                  type=\"text\" \n                  class=\"form-control\" \n                  id=\"title\" \n                  v-model=\"form.title\" \n                  required\n                  placeholder=\"请输入商品标题（如：二手 textbooks）\"\n                  maxlength=\"100\"\n                >\n              </div>\n\n              <!-- 商品价格 -->\n              <div class=\"mb-3\">\n                <label for=\"price\" class=\"form-label\">商品价格（元）<span class=\"text-danger\">*</span></label>\n                <input \n                  type=\"number\" \n                  class=\"form-control\" \n                  id=\"price\" \n                  v-model=\"form.price\" \n                  required\n                  min=\"0.01\" \n                  step=\"0.01\"\n                  placeholder=\"请输入价格\"\n                >\n              </div>\n\n              <!-- 商品描述 -->\n              <div class=\"mb-3\">\n                <label for=\"description\" class=\"form-label\">商品描述 <span class=\"text-danger\">*</span></label>\n                <textarea \n                  class=\"form-control\" \n                  id=\"description\" \n                  v-model=\"form.description\" \n                  required\n                  rows=\"5\"\n                  placeholder=\"请描述商品详情（新旧程度、使用情况等）\"\n                ></textarea>\n              </div>\n\n              <!-- 商品图片（可选） -->\n              <div class=\"mb-3\">\n                <label for=\"image\" class=\"form-label\">商品图片（可选）</label>\n                <input \n                  type=\"file\" \n                  class=\"form-control\" \n                  id=\"image\" \n                  accept=\"image/*\"\n                  @change=\"handleImageUpload\"\n                >\n                <!-- 预览选中的图片 -->\n                <div v-if=\"imagePreview\" class=\"mt-2\">\n                  <img :src=\"imagePreview\" class=\"img-thumbnail\" style=\"max-width: 200px;\" alt=\"预览图\">\n                </div>\n              </div>\n\n              <!-- 提交按钮 -->\n              <button \n                type=\"submit\" \n                class=\"btn btn-primary w-100\" \n                :disabled=\"submitting\"\n              >\n                <span v-if=\"submitting\" class=\"spinner-border spinner-border-sm me-2\"></span>\n                {{ submitting ? '发布中...' : '发布商品' }}\n              </button>\n            </form>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios'\n\nexport default {\n  data() {\n    return {\n      // 表单数据\n      form: {\n        title: '',        // 商品标题\n        price: '',        // 商品价格\n        description: '',  // 商品描述\n        image: null       // 图片文件（不直接绑定v-model，通过change事件处理）\n      },\n      imagePreview: '',  // 图片预览地址\n      submitting: false  // 提交状态（防止重复提交）\n    }\n  },\n  methods: {\n    // 处理图片上传预览\n    handleImageUpload(e) {\n      const file = e.target.files[0];\n      if (!file) return;\n\n      // 限制图片大小（如不超过5MB）\n      if (file.size > 5 * 1024 * 1024) {\n        alert('图片大小不能超过5MB');\n        e.target.value = ''; // 清空选中的文件\n        return;\n      }\n\n      // 预览图片\n      const reader = new FileReader();\n      reader.onload = (event) => {\n        this.imagePreview = event.target.result;\n      };\n      reader.readAsDataURL(file);\n\n      // 保存文件到表单数据\n      this.form.image = file;\n    },\n\n    // 提交发布商品\n    async handlePublish() {\n      // 简单验证\n      if (!this.form.title.trim()) {\n        alert('请输入商品标题');\n        return;\n      }\n      if (!this.form.price || this.form.price < 0.01) {\n        alert('请输入有效的商品价格');\n        return;\n      }\n      if (!this.form.description.trim()) {\n        alert('请输入商品描述');\n        return;\n      }\n\n      this.submitting = true; // 开始提交，禁用按钮\n\n      try {\n        // 创建FormData对象（用于上传文件）\n        const formData = new FormData();\n        formData.append('title', this.form.title);\n        formData.append('price', this.form.price);\n        formData.append('description', this.form.description);\n        if (this.form.image) {\n          formData.append('image', this.form.image); // 图片文件\n        }\n\n        // 调用后端发布商品接口（暂时模拟，后续替换为真实请求）\n        const response = await axios.post('/api/items', formData, {\n          headers: {\n            'Content-Type': 'multipart/form-data' // 上传文件必须的头信息\n          }\n        });\n\n        if (response.data.ok) {\n          alert('商品发布成功！');\n          this.$router.push('/'); // 发布成功后跳回首页\n        } else {\n          alert(response.data.message || '发布失败，请重试');\n        }\n      } catch (error) {\n        console.error('发布商品失败:', error);\n        alert('网络错误，请稍后再试');\n      } finally {\n        this.submitting = false; // 结束提交，启用按钮\n      }\n    }\n  }\n}\n</script>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}