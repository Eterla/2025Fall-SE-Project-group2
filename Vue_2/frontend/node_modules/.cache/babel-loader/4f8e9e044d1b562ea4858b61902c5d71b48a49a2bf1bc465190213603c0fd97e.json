{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, toDisplayString as _toDisplayString, normalizeClass as _normalizeClass } from \"vue\";\nconst _hoisted_1 = {\n  class: \"container\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"text-center py-5\"\n};\nconst _hoisted_3 = {\n  key: 1,\n  class: \"text-center py-5\"\n};\nconst _hoisted_4 = {\n  key: 2,\n  class: \"row mt-4\"\n};\nconst _hoisted_5 = {\n  class: \"col-md-6\"\n};\nconst _hoisted_6 = [\"src\", \"alt\"];\nconst _hoisted_7 = {\n  class: \"col-md-6\"\n};\nconst _hoisted_8 = {\n  class: \"mb-3\"\n};\nconst _hoisted_9 = {\n  class: \"text-danger fs-3 mb-4\"\n};\nconst _hoisted_10 = {\n  class: \"card mb-4\"\n};\nconst _hoisted_11 = {\n  class: \"card-body\"\n};\nconst _hoisted_12 = {\n  class: \"card-text\"\n};\nconst _hoisted_13 = {\n  class: \"card-text\"\n};\nconst _hoisted_14 = {\n  class: \"text-muted\"\n};\nconst _hoisted_15 = {\n  class: \"card-text\"\n};\nconst _hoisted_16 = {\n  class: \"text-muted\"\n};\nconst _hoisted_17 = {\n  class: \"card mb-4\"\n};\nconst _hoisted_18 = {\n  class: \"card-body\"\n};\nconst _hoisted_19 = {\n  class: \"card-text\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_router_link = _resolveComponent(\"router-link\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createCommentVNode(\" 加载中提示 \"), $data.loading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [...(_cache[2] || (_cache[2] = [_createElementVNode(\"div\", {\n    class: \"spinner-border text-primary\",\n    role: \"status\"\n  }, [_createElementVNode(\"span\", {\n    class: \"visually-hidden\"\n  }, \"Loading...\")], -1 /* CACHED */)]))])) : _createCommentVNode(\"v-if\", true), _createCommentVNode(\" 商品不存在提示 \"), !$data.loading && !$data.item ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [_cache[4] || (_cache[4] = _createElementVNode(\"h3\", null, \"商品不存在或已被删除\", -1 /* CACHED */)), _createVNode(_component_router_link, {\n    to: \"/\",\n    class: \"btn btn-primary mt-3\"\n  }, {\n    default: _withCtx(() => [...(_cache[3] || (_cache[3] = [_createTextVNode(\"返回首页\", -1 /* CACHED */)]))]),\n    _: 1 /* STABLE */\n  })])) : _createCommentVNode(\"v-if\", true), _createCommentVNode(\" 商品详情 \"), !$data.loading && $data.item ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, [_createCommentVNode(\" 商品图片 \"), _createElementVNode(\"div\", _hoisted_5, [_createElementVNode(\"img\", {\n    src: $data.item.imagePath ? `/images/${$data.item.imagePath}` : '/images/default.jpg',\n    class: \"img-fluid rounded\",\n    alt: $data.item.title\n  }, null, 8 /* PROPS */, _hoisted_6)]), _createCommentVNode(\" 商品信息 \"), _createElementVNode(\"div\", _hoisted_7, [_createElementVNode(\"h2\", _hoisted_8, _toDisplayString($data.item.title), 1 /* TEXT */), _createElementVNode(\"p\", _hoisted_9, \"¥\" + _toDisplayString($data.item.price), 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_10, [_createElementVNode(\"div\", _hoisted_11, [_cache[5] || (_cache[5] = _createElementVNode(\"h5\", {\n    class: \"card-title\"\n  }, \"商品描述\", -1 /* CACHED */)), _createElementVNode(\"p\", _hoisted_12, _toDisplayString($data.item.description), 1 /* TEXT */), _cache[6] || (_cache[6] = _createElementVNode(\"hr\", null, null, -1 /* CACHED */)), _createElementVNode(\"p\", _hoisted_13, [_createElementVNode(\"small\", _hoisted_14, \"发布时间：\" + _toDisplayString($data.item.createdAt), 1 /* TEXT */)]), _createElementVNode(\"p\", _hoisted_15, [_createElementVNode(\"small\", _hoisted_16, \"状态：\" + _toDisplayString($data.item.status === 'available' ? '可交易' : '已售出'), 1 /* TEXT */)])])]), _createCommentVNode(\" 卖家信息 \"), _createElementVNode(\"div\", _hoisted_17, [_createElementVNode(\"div\", _hoisted_18, [_cache[7] || (_cache[7] = _createElementVNode(\"h5\", {\n    class: \"card-title\"\n  }, \"卖家信息\", -1 /* CACHED */)), _createElementVNode(\"p\", _hoisted_19, \"用户名：\" + _toDisplayString($data.item.seller.username), 1 /* TEXT */), _createCommentVNode(\" 登录后显示聊天按钮 \"), $data.isLogin && $data.item.seller.id !== $data.currentUserId ? (_openBlock(), _createElementBlock(\"button\", {\n    key: 0,\n    class: \"btn btn-primary me-2\",\n    onClick: _cache[0] || (_cache[0] = (...args) => $options.goToChat && $options.goToChat(...args))\n  }, \" 联系卖家 \")) : _createCommentVNode(\"v-if\", true)])]), _createCommentVNode(\" 收藏按钮（登录后显示） \"), $data.isLogin ? (_openBlock(), _createElementBlock(\"button\", {\n    key: 0,\n    class: \"btn btn-outline-primary\",\n    onClick: _cache[1] || (_cache[1] = (...args) => $options.toggleFavorite && $options.toggleFavorite(...args))\n  }, [_createElementVNode(\"i\", {\n    class: _normalizeClass([\"bi\", $data.isFavorite ? 'bi-heart-fill text-danger' : 'bi-heart'])\n  }, null, 2 /* CLASS */), _createTextVNode(\" \" + _toDisplayString($data.isFavorite ? '取消收藏' : '收藏商品'), 1 /* TEXT */)])) : _createCommentVNode(\"v-if\", true)])])) : _createCommentVNode(\"v-if\", true)]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createCommentVNode","$data","loading","_hoisted_2","_cache","_createElementVNode","role","item","_hoisted_3","_createVNode","_component_router_link","to","_hoisted_4","_hoisted_5","src","imagePath","alt","title","_hoisted_7","_hoisted_8","_toDisplayString","_hoisted_9","price","_hoisted_10","_hoisted_11","_hoisted_12","description","_hoisted_13","_hoisted_14","createdAt","_hoisted_15","_hoisted_16","status","_hoisted_17","_hoisted_18","_hoisted_19","seller","username","isLogin","id","currentUserId","onClick","args","$options","goToChat","toggleFavorite","_normalizeClass","isFavorite"],"sources":["D:\\21626\\MyFiles\\files\\2025fall\\SE\\Vue_2\\frontend\\src\\views\\ItemDetail.vue"],"sourcesContent":["<template>\n  <div class=\"container\">\n    <!-- 加载中提示 -->\n    <div v-if=\"loading\" class=\"text-center py-5\">\n      <div class=\"spinner-border text-primary\" role=\"status\">\n        <span class=\"visually-hidden\">Loading...</span>\n      </div>\n    </div>\n\n    <!-- 商品不存在提示 -->\n    <div v-if=\"!loading && !item\" class=\"text-center py-5\">\n      <h3>商品不存在或已被删除</h3>\n      <router-link to=\"/\" class=\"btn btn-primary mt-3\">返回首页</router-link>\n    </div>\n\n    <!-- 商品详情 -->\n    <div v-if=\"!loading && item\" class=\"row mt-4\">\n      <!-- 商品图片 -->\n      <div class=\"col-md-6\">\n        <img \n          :src=\"item.imagePath ? `/images/${item.imagePath}` : '/images/default.jpg'\" \n          class=\"img-fluid rounded\" \n          :alt=\"item.title\"\n        >\n      </div>\n\n      <!-- 商品信息 -->\n      <div class=\"col-md-6\">\n        <h2 class=\"mb-3\">{{ item.title }}</h2>\n        <p class=\"text-danger fs-3 mb-4\">¥{{ item.price }}</p>\n\n        <div class=\"card mb-4\">\n          <div class=\"card-body\">\n            <h5 class=\"card-title\">商品描述</h5>\n            <p class=\"card-text\">{{ item.description }}</p>\n            <hr>\n            <p class=\"card-text\">\n              <small class=\"text-muted\">发布时间：{{ item.createdAt }}</small>\n            </p>\n            <p class=\"card-text\">\n              <small class=\"text-muted\">状态：{{ item.status === 'available' ? '可交易' : '已售出' }}</small>\n            </p>\n          </div>\n        </div>\n\n        <!-- 卖家信息 -->\n        <div class=\"card mb-4\">\n          <div class=\"card-body\">\n            <h5 class=\"card-title\">卖家信息</h5>\n            <p class=\"card-text\">用户名：{{ item.seller.username }}</p>\n            <!-- 登录后显示聊天按钮 -->\n            <button \n              class=\"btn btn-primary me-2\" \n              @click=\"goToChat\"\n              v-if=\"isLogin && item.seller.id !== currentUserId\"\n            >\n              联系卖家\n            </button>\n          </div>\n        </div>\n\n        <!-- 收藏按钮（登录后显示） -->\n        <button \n          class=\"btn btn-outline-primary\" \n          @click=\"toggleFavorite\"\n          v-if=\"isLogin\"\n        >\n          <i class=\"bi\" :class=\"isFavorite ? 'bi-heart-fill text-danger' : 'bi-heart'\"></i>\n          {{ isFavorite ? '取消收藏' : '收藏商品' }}\n        </button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios'\n\nexport default {\n  data() {\n    return {\n      loading: true,       // 加载状态\n      item: null,          // 商品详情数据\n      isLogin: false,      // 是否登录\n      currentUserId: null, // 当前登录用户ID\n      isFavorite: false    // 是否已收藏\n    }\n  },\n  created() {\n    // 页面加载时获取商品详情\n    this.getItemDetail();\n    // 检查登录状态\n    this.checkLoginStatus();\n  },\n  methods: {\n    // 获取商品详情\n    async getItemDetail() {\n      const itemId = this.$route.params.id; // 从路由参数中获取商品ID\n      try {\n        const response = await axios.get(`/api/items/${itemId}`);\n        if (response.data.ok) {\n          this.item = response.data.data;\n          // 检查是否已收藏\n          this.checkFavoriteStatus();\n        } else {\n          alert(response.data.message || '获取商品失败');\n        }\n      } catch (error) {\n        console.error('获取商品详情失败:', error);\n        alert('网络错误，请稍后再试');\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    // 检查登录状态\n    checkLoginStatus() {\n      const token = localStorage.getItem('access_token');\n      const userInfo = localStorage.getItem('user_info');\n      if (token && userInfo) {\n        this.isLogin = true;\n        this.currentUserId = JSON.parse(userInfo).id;\n      }\n    },\n\n    // 检查是否已收藏\n    async checkFavoriteStatus() {\n      if (!this.isLogin || !this.item) return;\n      try {\n        const response = await axios.get(`/api/favorites/check?item_id=${this.item.id}`);\n        this.isFavorite = response.data.data.is_favorite;\n      } catch (error) {\n        console.error('检查收藏状态失败:', error);\n      }\n    },\n\n    // 切换收藏状态\n    async toggleFavorite() {\n      try {\n        if (this.isFavorite) {\n          // 取消收藏\n          await axios.delete(`/api/favorites/${this.item.id}`);\n          this.isFavorite = false;\n          alert('取消收藏成功');\n        } else {\n          // 收藏商品\n          await axios.post('/api/favorites', { item_id: this.item.id });\n          this.isFavorite = true;\n          alert('收藏成功');\n        }\n      } catch (error) {\n        console.error('切换收藏状态失败:', error);\n        alert('操作失败，请稍后再试');\n      }\n    },\n\n    // 跳转到聊天页面\n    goToChat() {\n      this.$router.push({\n        name: 'ChatDetail',\n        params: {\n          otherUserId: this.item.seller.id,\n          itemId: this.item.id\n        }\n      });\n    }\n  }\n}\n</script>\n\n<style>\n/* 商品详情页图片样式 */\n.img-fluid {\n  max-height: 500px;\n  object-fit: contain;\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}