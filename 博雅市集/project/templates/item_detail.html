{% extends "base.html" %}

{% block title %}{{ item.title }} - 博雅市集{% endblock %}

{% block content %}
    <div class="card mb-4">
        <div class="row g-0">
            <div class="col-md-5">
                {% if item.image_path %}
                    <img src="{{ url_for('static', filename=item.image_path) }}" class="img-fluid rounded-start" alt="{{ item.title }}">
                {% else %}
                    <img src="{{ url_for('static', filename='images/default.jpg') }}" class="img-fluid rounded-start" alt="默认图片">
                {% endif %}
            </div>
            <div class="col-md-7">
                <div class="card-body">
                    <h2 class="card-title">{{ item.title }}</h2>
                    <p class="card-text text-danger font-weight-bold fs-3">¥{{ item.price }}</p>
                    <p class="card-text">{{ item.description }}</p>
                    <p class="card-text"><small class="text-muted">标签: {{ item.tags }}</small></p>
                    <p class="card-text"><small class="text-muted">发布时间: {{ item.created_at }}</small></p>
                    <p class="card-text"><small class="text-muted">卖家: {{ seller.username }}</small></p>
                    
                    <div class="mt-4">
                        {% if 'user_id' in session %}
                            {% if session['user_id'] != item.seller_id %}
                                <!-- 收藏按钮 -->
                                <form action="{{ url_for('main.toggle_favorite', item_id=item.id) }}" method="post" class="d-inline">
                                    <button type="submit" class="btn btn-outline-primary me-2">
                                        {% if is_favorite %}取消收藏{% else %}收藏{% endif %}
                                    </button>
                                </form>
                                <!-- 联系卖家按钮 -->
                                <a href="{{ url_for('messages.send_message', seller_id=seller.id, item_id=item.id) }}" class="btn btn-primary">联系卖家</a>
                            {% else %}
                                <p class="text-muted">这是您发布的商品</p>
                            {% endif %}
                        {% else %}
                            <a href="{{ url_for('auth.login') }}" class="btn btn-primary">登录后查看详情</a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}